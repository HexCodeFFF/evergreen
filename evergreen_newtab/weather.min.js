var isModule="undefined"!=typeof module&&module.exports;isModule&&(http=require("http"),URL=require("url"));var Weather={Utils:{},VERSION:"0.0.3"},jsonp=Weather.Utils.jsonp=function(e,t){return new Promise(function(t,n){var r="_"+Math.round(1e4*Math.random()),a="jsonp_callback_"+r,o=document.getElementsByTagName("head")[0]||document.body||document.documentElement,i=document.createElement("script"),u=e+"&callback="+a;window[a]=function(e){delete window[a];var n=document.getElementById(r);n.parentNode.removeChild(n),t(e)},i.src=u,i.id=r,i.addEventListener("error",n),o.appendChild(i)})};Weather.setApiKey=function(e){Weather.APIKEY=e},Weather.getApiKey=function(){return Weather.APIKEY},Weather.kelvinToFahrenheit=function(e){return 1.8*this.kelvinToCelsius(e)+32},Weather.kelvinToCelsius=function(e){return e-273.15},Weather.getCurrent=function(e,t){var n="https://api.openweathermap.org/data/2.5/forecast?q="+encodeURIComponent(e)+"&cnt=1";return Weather.APIKEY?n=n+"&APPID="+Weather.APIKEY:console.log("WARNING: You must set an apiKey for openweathermap"),this._getJSON(n,function(e){t(new Weather.Current(e))})},Weather.getCurrentLatLong=function(e,t,n){var r="https://api.openweathermap.org/data/2.5/forecast?lat="+encodeURIComponent(e)+"&lon="+encodeURIComponent(t)+"&cnt=1";return Weather.APIKEY?r=r+"&APPID="+Weather.APIKEY:console.log("WARNING: You must set an apiKey for openweathermap"),this._getJSON(r,function(e){n(new Weather.Current(e))})},Weather.getForecast=function(e,t){var n="https://api.openweathermap.org/data/2.5/forecast?q="+encodeURIComponent(e)+"&cnt=1";return Weather.APIKEY?n=n+"&APPID="+Weather.APIKEY:console.log("WARNING: You must set an apiKey for openweathermap"),this._getJSON(n,function(e){t(new Weather.Forecast(e))})},Weather.getForecastLatLong=function(e,t,n){var r="https://api.openweathermap.org/data/2.5/forecast?lat="+encodeURIComponent(e)+"&lon="+encodeURIComponent(t)+"&cnt=1";return Weather.APIKEY?r=r+"&APPID="+Weather.APIKEY:console.log("WARNING: You must set an apiKey for openweathermap"),this._getJSON(r,function(e){n(new Weather.Forecast(e))})},Weather._getJSON=function(e,t){if(isModule)return http.get(URL.parse(e),function(e){return t(e.body)});jsonp(e).then(t)};var maxBy=Weather.Utils.maxBy=function(e,t){var n;return e.reduce(function(e,r){var a=t(r);return(null===e||a>n)&&(n=a,e=r),e},null)},minBy=Weather.Utils.minBy=function(e,t){var n;return e.reduce(function(e,r){var a=t(r);return(null===e||a<n)&&(n=a,e=r),e},null)},isOnDate=Weather.Utils.isOnDate=function(e,t){var n=e.getYear()===t.getYear(),r=e.getMonth()===t.getMonth(),a=e.getDate()===t.getDate();return n&&r&&a};Weather.Forecast=function(e){this.data=e},Weather.Forecast.prototype.startAt=function(){return new Date(1e3*minBy(this.data.list,function(e){return e.dt}).dt)},Weather.Forecast.prototype.endAt=function(){return new Date(1e3*maxBy(this.data.list,function(e){return e.dt}).dt)},Weather.Forecast.prototype.day=function(e){return new Weather.Forecast(this._filter(e))},Weather.Forecast.prototype.low=function(){if(0!==this.data.list.length)return minBy(this.data.list,function(e){return e.main.temp_min}).main.temp_min},Weather.Forecast.prototype.high=function(){if(0!==this.data.list.length)return maxBy(this.data.list,function(e){return e.main.temp_max}).main.temp_max},Weather.Forecast.prototype._filter=function(e){return{list:this.data.list.filter(function(t){var n=1e3*t.dt;if(isOnDate(new Date(n),e))return t})}},Weather.Current=function(e){this.data=e},Weather.Current.prototype.temperature=function(){return this.data.list[0].main.temp},Weather.Current.prototype.conditions=function(){return this.data.list[0].weather[0].description},isModule?module.exports=Weather:window.Weather=Weather;